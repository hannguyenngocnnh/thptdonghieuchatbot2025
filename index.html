<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Gia S∆∞ & Tr·ª£ L√Ω AI To√°n H·ªçc</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script>
  <!-- C·∫•u h√¨nh MathJax ƒë·ªÉ fix font to√°n -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']]
      },
      chtml: {
        fontURL: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2' // Force font URL
      },
      startup: {
        ready: function() {
          MathJax.startup.defaultReady();
          MathJax.startup.document.outputJax.options.font = 'STIX-Web'; // S·ª≠ d·ª•ng font STIX-Web cho to√°n
        }
      }
    };
  </script>

  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      background: linear-gradient(135deg, #e0f2fe, #f0f9ff);
      font-family: "Roboto", sans-serif;
      color: #2563eb; /* ƒê·ªïi m√†u ch·ªØ ch√≠nh th√†nh xanh d∆∞∆°ng */
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    /* Sidebar */
    #sidebar {
      width: 260px;
      background: linear-gradient(180deg, #2563eb, #3b82f6);
      color: white;
      padding: 25px 20px;
      display: flex;
      flex-direction: column;
      box-shadow: 4px 0 15px rgba(0,0,0,0.15);
      overflow-y: auto;
    }

    #sidebar h2 {
      text-align: center;
      background: linear-gradient(90deg, #3b82f6, #6366f1);
      -webkit-background-clip: text;
      color: transparent;
      font-weight: 700;
      font-size: 18px;
      margin-bottom: 20px;
    }

    .group {
      margin-bottom: 16px;
    }

    .group h3 {
      font-size: 15px;
      margin-bottom: 8px;
      color: #dbeafe;
    }

    .option {
      padding: 8px;
      background: rgba(255,255,255,0.15);
      border-radius: 10px;
      margin: 5px 0;
      text-align: center;
      cursor: pointer;
      transition: 0.2s;
    }

    .option:hover {
      background: rgba(255,255,255,0.35);
      transform: scale(1.05);
    }

    .selected {
      background: #60a5fa;
      font-weight: bold;
    }

    /* Chat container */
    #main {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      position: relative; /* ƒê·ªÉ ƒë·ªãnh v·ªã h∆∞·ªõng d·∫´n */
    }

    /* H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng tr√™n c√πng b√™n ph·∫£i */
    #guide {
      position: absolute;
      top: 10px;
      right: 20px;
      font-size: 14px;
      color: #2563eb;
      background: rgba(255,255,255,0.9);
      padding: 8px 12px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      max-width: 300px;
    }

    h1 {
      font-size: 28px;
      font-weight: 700;
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(90deg, #3b82f6, #6366f1); /* M√†u xanh loang t√≠m */
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent; /* Fallback cho browser c≈© */
      color: #2563eb; /* Fallback color n·∫øu gradient kh√¥ng ho·∫°t ƒë·ªông */
      margin-bottom: 10px;
      text-align: center;
    }

    #chat-box {
      width: 90%;
      max-width: 720px;
      height: 70vh;
      overflow-y: auto;
      background: white;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 4px 25px rgba(0,0,0,0.1);
      border: 1px solid #e2e8f0;
    }

    .user, .bot {
      margin: 10px 0;
      padding: 12px 14px;
      border-radius: 10px;
      line-height: 1.6; /* TƒÉng line-height ƒë·ªÉ xu·ªëng d√≤ng h·ª£p l√Ω h∆°n */
      word-wrap: break-word;
      white-space: pre-wrap; /* Gi·ªØ nguy√™n xu·ªëng d√≤ng t·ª´ AI */
    }

    .user {
      background: #2563eb;
      color: white;
      text-align: right;
      border-bottom-right-radius: 0;
    }

    .bot {
      background: #f1f5f9;
      color: #1e3a8a;
      border-bottom-left-radius: 0;
    }

    #input-area {
      width: 90%;
      max-width: 720px;
      display: flex;
      margin-top: 12px;
    }

    textarea {
      flex: 1;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid #93c5fd;
      font-size: 15px;
      resize: none;
      outline: none;
      transition: 0.2s;
    }

    textarea:focus {
      border-color: #2563eb;
      box-shadow: 0 0 6px #93c5fd;
    }

    button {
      margin-left: 10px;
      background: linear-gradient(135deg, #2563eb, #3b82f6);
      color: white;
      padding: 12px 22px;
      border-radius: 12px;
      cursor: pointer;
      border: none;
      font-weight: bold;
      transition: 0.2s;
    }

    button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 8px rgba(59,130,246,0.3);
    }

    .sources {
      margin-top: 8px;
      font-size: 13px;
      color: #334155;
    }

    .sources a {
      color: #2563eb;
      text-decoration: none;
    }
    .sources a:hover {
      text-decoration: underline;
    }
  </style>
</head>

<body>
  <!-- Sidebar -->
  <div id="sidebar">
    <h2>üìö Menu H·ªçc T·∫≠p</h2>
    <div class="group">
      <h3>üß† H·ªçc T·∫≠p</h3>
      <div class="option selected" onclick="selectOption(this,'gi·∫£i b√†i t·∫≠p')">‚úèÔ∏è Gi·∫£i b√†i t·∫≠p</div>
      <div class="option" onclick="selectOption(this,'√¥n l√Ω thuy·∫øt')">üìò √în l√Ω thuy·∫øt</div>
      <div class="option" onclick="selectOption(this,'t√≥m t·∫Øt b√†i h·ªçc')">üìÑ T√≥m t·∫Øt b√†i h·ªçc</div>
    </div>

    <div class="group">
      <h3>üìó M√¥n H·ªçc</h3>
      <div class="option" onclick="selectOption(this,'to√°n h·ªçc')">‚ûï To√°n h·ªçc</div>
      <div class="option" onclick="selectOption(this,'v·∫≠t l√Ω')">‚öôÔ∏è V·∫≠t l√Ω</div>
      <div class="option" onclick="selectOption(this,'h√≥a h·ªçc')">üß™ H√≥a h·ªçc</div>
      <div class="option" onclick="selectOption(this,'ng·ªØ vƒÉn')">üìñ Ng·ªØ vƒÉn</div>
      <div class="option" onclick="selectOption(this,'ti·∫øng anh')">üåç Ti·∫øng Anh</div>
    </div>

    <div class="group">
      <h3>üí° Kh√°c</h3>
      <div class="option" onclick="selectOption(this,'m·∫πo h·ªçc t·∫≠p')">üí´ M·∫πo h·ªçc t·∫≠p</div>
      <div class="option" onclick="selectOption(this,'gi·∫£i th√≠ch kh√°i ni·ªám')">üìé Gi·∫£i th√≠ch kh√°i ni·ªám</div>
      <div class="option" onclick="selectOption(this,'fun fact h·ªçc t·∫≠p')">üéà Fun fact</div>
    </div>
  </div>

  <!-- Main -->
  <div id="main">
    <div id="guide">H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng: L·ª±a ch·ªçn ch·∫ø ƒë·ªô b·∫°n mu·ªën d√πng ·ªü menu b√™n tr√°i, nh·∫≠p c√¢u h·ªèi v√† ch·ªù AI ph·∫£n h·ªìi.</div>
    <h1>Gia s∆∞ & tr·ª£ l√Ω h·ªçc t·∫≠p</h1>
    <div id="chat-box"></div>
    <div id="input-area">
      <textarea id="input" rows="2" placeholder="Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n... (Enter ƒë·ªÉ g·ª≠i, Shift+Enter ƒë·ªÉ xu·ªëng d√≤ng)"></textarea>
      <button onclick="sendMessage()">G·ª≠i</button>
    </div>
  </div>

  <script>
    let selectedMode = "gi·∫£i b√†i t·∫≠p";
    const API_KEY = "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";

    // Sidebar ch·ªçn ch·∫ø ƒë·ªô
    function selectOption(el, mode) {
      document.querySelectorAll(".option").forEach(o => o.classList.remove("selected"));
      el.classList.add("selected");
      selectedMode = mode;
    }

    // G·ª≠i b·∫±ng Enter
    const textarea = document.getElementById("input");
    textarea.addEventListener("keydown", e => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    // Tin nh·∫Øn ch√†o
    window.onload = () => {
      const chatBox = document.getElementById("chat-box");
      chatBox.innerHTML = `
        <div class="bot">
          Xin ch√†o üëã M√¨nh l√† Gia S∆∞ & Tr·ª£ L√Ω AI c√°c m√¥n h·ªçc üíô<br>
          M√¨nh ·ªü ƒë√¢y ƒë·ªÉ ƒë·ªìng h√†nh c√πng b·∫°n tr√™n h√†nh tr√¨nh h·ªçc t·∫≠p nh√©! üìò‚ú®
        </div>`;
    };

    async function sendMessage() {
      const input = document.getElementById("input");
      const chatBox = document.getElementById("chat-box");
      const userMsg = input.value.trim();
      if (!userMsg) return;
      input.value = "";

      chatBox.innerHTML += `<div class="user">${userMsg}</div>`;

      const botDiv = document.createElement("div");
      botDiv.classList.add("bot");
      chatBox.appendChild(botDiv);
      chatBox.scrollTop = chatBox.scrollHeight;

      const response = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${API_KEY}`
        },
        body: JSON.stringify({
          model: "gpt-4o-mini",
          stream: true,
          messages: [
            { role: "system", content: `B·∫°n l√† gia s∆∞ AI vui v·∫ª, chuy√™n gi·∫£i th√≠ch To√°n h·ªçc v√† c√°c m√¥n h·ªçc kh√°c. H√£y tr·∫£ l·ªùi theo phong c√°ch chuy√™n nghi·ªáp, d·ªÖ hi·ªÉu, th√¢n thi·ªán v√† th√™m emoji h·ªçc t·∫≠p n·∫øu h·ª£p l√Ω. Cu·ªëi m·ªói c√¢u tr·∫£ l·ªùi, g·ª£i √Ω 2‚Äì3 link h·ªçc t·∫≠p (Wikipedia, YouTube, hocmai.vn, v.v.).` },
            { role: "user", content: userMsg }
          ]
        })
      });

      const reader = response.body.getReader();
      const decoder = new TextDecoder("utf-8");
      let buffer = "";
      let accumulatedText = ""; // T√≠ch l≈©y text ƒë·ªÉ c·∫≠p nh·∫≠t batch
      let lastUpdateTime = Date.now();

      while (true) {
        const { done, value } = await reader.read();
        if (done) {
          // C·∫≠p nh·∫≠t l·∫ßn cu·ªëi v√† render MathJax
          if (accumulatedText) {
            botDiv.insertAdjacentHTML("beforeend", accumulatedText);
            accumulatedText = "";
          }
          MathJax.typesetPromise([botDiv]); // Render MathJax cho ph·∫ßn botDiv
          botDiv.insertAdjacentHTML("beforeend", `
            <div class="sources">
              üîó T√†i li·ªáu tham kh·∫£o: 
              <a href="https://vi.wikipedia.org" target="_blank">Wikipedia</a> ‚Ä¢ 
              <a href="https://www.khanacademy.org/math" target="_blank">Khan Academy</a> ‚Ä¢ 
              <a href="https://hocmai.vn" target="_blank">Hocmai.vn</a>
            </div>`);
          chatBox.scrollTop = chatBox.scrollHeight;
          return;
        }

        buffer += decoder.decode(value);
        const parts = buffer.split("\n\n");
        buffer = parts.pop();

        for (const part of parts) {
          if (part.includes("data: ")) {
            const json = part.replace("data: ", "").trim();
            if (json === "[DONE]") return;
            try {
              const data = JSON.parse(json);
              const text = data.choices?.[0]?.delta?.content || "";
              accumulatedText += text; // T√≠ch l≈©y text
            } catch {}
          }
        }

        // C·∫≠p nh·∫≠t DOM m·ªói 20ms ƒë·ªÉ gi·∫£m lag v√† tƒÉng t·ªëc ƒë·ªô hi·ªÉn th·ªã
        const now = Date.now();
        if (now - lastUpdateTime > 20 && accumulatedText) {
          botDiv.insertAdjacentHTML("beforeend", accumulatedText);
          MathJax.typesetPromise([botDiv]); // Render MathJax ngay l·∫≠p t·ª©c cho ph·∫ßn m·ªõi
          accumulatedText = "";
          lastUpdateTime = now;
          chatBox.scrollTop = chatBox.scrollHeight;
        }
      }
    }
  </script>
</body>
</html>
